---
phase: 01-foundation
plan: 03
type: execute
---

<objective>
Create base layout and language switcher component for the bilingual site.

Purpose: Establish the visual foundation with proper HTML structure and a functional language switcher.
Output: Base layout component, language switcher component, and updated homepage using the new layout.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-01-SUMMARY.md

**Architecture patterns from RESEARCH.md:**
```
src/
├── layouts/             # Shared layouts
│   └── Layout.astro
├── components/          # Astro components
│   └── LanguageSwitch.astro
```

**Code examples from RESEARCH.md (Language Switcher):**
```astro
---
const { currentLocale } = Astro.props;
const locales = ['en', 'ta'];
const path = Astro.url.pathname;
---
<div class="language-switch">
  {locales.map(locale => (
    <a
      href={`/${locale === 'en' ? '' : locale}${path}`}
      class={currentLocale === locale ? 'active' : ''}
    >
      {locale === 'en' ? 'English' : 'தமிழ்'}
    </a>
  ))}
</div>
```

**Phase context:**
- This is foundation - keep layout minimal (typography system comes in Phase 2)
- Focus on structure and functionality, not visual design
- Language switcher must work for both / and /ta/ routes
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create base layout component</name>
  <files>src/layouts/Layout.astro</files>
  <action>Create src/layouts/ directory and Layout.astro with:

```astro
---
// Base layout with language switcher
interface Props {
  title?: string;
  currentLocale?: 'en' | 'ta';
}

const {
  title = 'UngalSoththu - உங்கள் சொத்து',
  currentLocale = 'en'
} = Astro.props;

const localeTitles = {
  en: 'This is Your Asset',
  ta: 'இது உங்கள் சொத்து'
};
---

<html lang={currentLocale}>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
  </head>
  <body>
    <header>
      <h1>UngalSoththu / உங்கள் சொத்து</h1>
      <p>{localeTitles[currentLocale]}</p>
    </header>
    <main>
      <slot />
    </main>
    <footer>
      <p>&copy; 2025 UngalSoththu. Urban Transit Accountability.</p>
    </footer>
  </body>
</html>

<style is:global>
  /* Minimal base styles - full design system in Phase 2 */
  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: system-ui, -apple-system, sans-serif;
    line-height: 1.6;
    max-width: 800px;
    margin: 0 auto;
    padding: 1rem;
  }

  header {
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #ccc;
  }

  footer {
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid #ccc;
    font-size: 0.875rem;
  }
</style>
```

DO NOT add Tamil fonts yet - that's Phase 2 design system work.
Keep styles minimal - focus on structure.
  </action>
  <verify>src/layouts/Layout.astro exists with proper HTML structure</verify>
  <done>Layout has html, head, body with header, main, footer; includes slot for content</done>
</task>

<task type="auto">
  <name>Task 2: Create language switcher component</name>
  <files>src/components/LanguageSwitch.astro</files>
  <action>Create src/components/ directory and LanguageSwitch.astro with:

```astro
---
// Language switcher component
interface Props {
  currentLocale: 'en' | 'ta';
}

const { currentLocale } = Astro.props;
const path = Astro.url.pathname;

// Build switch URL: remove current locale prefix, add new one
function getLocalePath(newLocale: 'en' | 'ta', currentPath: string) {
  // Remove /ta/ prefix if present
  const withoutLocale = currentPath.replace(/^\/ta\//, '/').replace(/^\/ta$/, '/');
  // Add new locale prefix (empty for 'en')
  return newLocale === 'en' ? withoutLocale : `/ta${withoutLocale}`;
}

const locales: Array<{code: 'en' | 'ta', label: string}> = [
  { code: 'en', label: 'English' },
  { code: 'ta', label: 'தமிழ்' }
];
---

<nav class="lang-switch" aria-label="Language switch">
  {locales.map(locale => (
    <a
      href={getLocalePath(locale.code, path)}
      aria-label={`Switch to ${locale.label}`}
      class:active={currentLocale === locale.code}
    >
      {locale.label}
    </a>
  ))}
</nav>

<style>
  .lang-switch {
    display: flex;
    gap: 1rem;
    margin-top: 0.5rem;
  }

  .lang-switch a {
    text-decoration: none;
    color: #0066cc;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
  }

  .lang-switch a:hover {
    background-color: #f0f0f0;
  }

  .lang-switch a.active {
    font-weight: bold;
    background-color: #e0e0e0;
    color: #000;
  }
</style>
```

Key logic:
- getLocalePath handles URL transformation between locales
- Works on root (/), /ta/, and nested paths
- Active state styling shows current language

DO NOT use client-side JavaScript for routing - use native links (per RESEARCH.md).
  </action>
  <verify>src/components/LanguageSwitch.astro exists with switch logic</verify>
  <done>Component has language links, active state styling, uses server-side routing only</done>
</task>

<task type="auto">
  <name>Task 3: Update homepage to use new layout and language switcher</name>
  <files>src/pages/index.astro</files>
  <action>Replace src/pages/index.astro with:

```astro
---
import Layout from '../layouts/Layout.astro';
import LanguageSwitch from '../components/LanguageSwitch.astro';

const currentLocale: 'en' | 'ta' = 'en';
---

<Layout title="UngalSoththu" currentLocale={currentLocale}>
  <LanguageSwitch currentLocale={currentLocale} />

  <section>
    <h2>Welcome</h2>
    <p>
      Data-as-accountability: Citizens deserve verifiable data on public assets they fund.
      When buses sit idle or tracking fails, it's not just inconvenience—it's a failure
      to utilize assets that belong to the public.
    </p>
    <p>
      <strong>Ithu Ungal Soththu.</strong> This is Your Asset.
    </p>
  </section>
</Layout>
```

Also create src/pages/ta/index.astro for Tamil:

```astro
---
import Layout from '../../layouts/Layout.astro';
import LanguageSwitch from '../../components/LanguageSwitch.astro';

const currentLocale: 'en' | 'ta' = 'ta';
---

<Layout title="உங்கள் சொத்து - UngalSoththu" currentLocale={currentLocale}>
  <LanguageSwitch currentLocale={currentLocale} />

  <section>
    <h2>வரவேற்பு</h2>
    <p>
      தரவு என்பது பொறுப்புக்கூறு: குடிமக்கள் தாங்கள் நிதி உதவி வழங்கும் பொது சொத்துகள் பற்றிய
      சரிபார்க்கக்கூடிய தரவைப் பெற முடியும். பேருந்துகள் செயல்படாமல் இருந்தால் அல்லது
      கண்காணிப்பு தோல்வியடைந்தால், அது வெறும் சௌகரியம் மட்டுமல்ல -
      பொதுமக்களுக்கு சொந்தமான சொத்துகளைப் பயன்படுத்தத் தவறியது.
    </p>
    <p>
      <strong>இது உங்கள் சொத்து.</strong> This is Your Asset.
    </p>
  </section>
</Layout>
```

DO NOT add complex content yet - this is just foundation structure.
  </action>
  <verify>src/pages/index.astro and src/pages/ta/index.astro both exist</verify>
  <done>Both pages use Layout and LanguageSwitch, have translated content</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Base layout with language switcher and bilingual homepage</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:4321
    3. Verify: Page shows layout with header, footer, content
    4. Verify: Language switcher shows "English" and "தமிழ்" links
    5. Click: "தமிழ்" link
    6. Verify: Navigates to http://localhost:4321/ta/
    7. Verify: Tamil content displays, "தமிழ்" link now has active style
    8. Click: "English" link
    9. Verify: Returns to http://localhost:4321/
    10. Check: No JavaScript errors in console
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] src/layouts/Layout.astro exists with proper HTML structure
- [ ] src/components/LanguageSwitch.astro exists and functional
- [ ] Both src/pages/index.astro and src/pages/ta/index.astro exist
- [ ] Language switcher works both directions (en ↔ ta)
- [ ] Active state shows correctly on language switcher
- [ ] No console errors
</verification>

<success_criteria>

- Base layout component created with semantic HTML structure
- Language switcher component functional with active state
- Bilingual homepage created (English and Tamil)
- Language switching works without client-side JavaScript
- Dev server runs without errors
  </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-03-SUMMARY.md`:

# Phase 1 Plan 3: Layouts & Language Switcher Summary

**Base layout and language switcher component created. Bilingual homepage deployed.**

## Accomplishments

- Created Layout.astro with semantic HTML structure (header, main, footer)
- Created LanguageSwitch.astro component with active state styling
- Created bilingual homepage (English at /, Tamil at /ta/)
- Language switching works via server-side routing (no client JS)

## Files Created/Modified

- `src/layouts/Layout.astro` - Base layout with semantic structure
- `src/components/LanguageSwitch.astro` - Language switcher navigation
- `src/pages/index.astro` - English homepage
- `src/pages/ta/index.astro` - Tamil homepage

## Decisions Made

- Used server-side routing for language switching (per RESEARCH.md pattern)
- Kept styles minimal - full design system deferred to Phase 2
- Active state styling shows current language

## Issues Encountered

None / [Document any issues if they occurred]

## Next Step

Ready for 01-04-PLAN.md (Content Collections Structure)
</output>
