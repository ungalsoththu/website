---
phase: 01-foundation
plan: 04
type: execute
---

<objective>
Set up Astro content collections for type-safe bilingual markdown content.

Purpose: Establish the content infrastructure that will be used for blog posts, campaigns, and reports.
Output: Content collections configured with sample bilingual content demonstrating the pattern.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/references/checkpoints.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation/01-RESEARCH.md
@.planning/phases/01-foundation/01-03-SUMMARY.md

**Architecture patterns from RESEARCH.md:**
```
src/
├── content/              # Markdown collections
│   ├── en/              # English content
│   │   ├── about.md
│   │   └── blog/
│   └── ta/              # Tamil content
│       ├── about.md
│       └── blog/
```

**Code examples from RESEARCH.md (Content Collections):**
```typescript
// src/content/config.ts
import { defineCollection, z } from 'astro:content'

const blog = defineCollection({
  schema: z.object({
    title: z.string(),
    description: z.string(),
    publishDate: z.date(),
    lang: z.enum(['en', 'ta']),
  })
})

export const collections = { blog }
```

**Phase context:**
- This is the final plan of Phase 1
- Collections will be used heavily in Phase 3 (Content Infrastructure)
- Keep it simple: one blog collection to demonstrate the pattern

**Don't hand-roll (from RESEARCH.md):**
- Don't create custom markdown processing - use Astro content collections
- Don't skip schema validation - use Zod for type safety
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create content collections configuration</name>
  <files>src/content.config.ts</files>
  <action>Create src/content.config.ts with blog collection:

```typescript
import { defineCollection, z } from 'astro:content';

// Blog collection schema
const blog = defineCollection({
  type: 'content',
  schema: z.object({
    title: z.string(),
    description: z.string(),
    publishDate: z.coerce.date(),
    lang: z.enum(['en', 'ta']),
    tags: z.array(z.string()).optional(),
  }),
});

// Export collections
export const collections = {
  blog,
};
```

Key points:
- type: 'content' enables markdown processing
- z.coerce.date() accepts both Date objects and ISO string format
- lang field tracks content language
- Optional tags array for future categorization

DO NOT create multiple collections yet - blog is sufficient to demonstrate pattern.
  </action>
  <verify>src/content.config.ts exists with valid TypeScript</verify>
  <done>Config exports blog collection with title, description, publishDate, lang schema</done>
</task>

<task type="auto">
  <name>Task 2: Create sample English blog post</name>
  <files>src/content/en/blog/first-post.md</files>
  <action>Create src/content/en/blog/ directory and first-post.md:

```markdown
---
title: "Welcome to UngalSoththu"
description: "Introducing our initiative for urban transit accountability in Tamil Nadu"
publishDate: 2025-01-11
lang: en
tags: ["announcement"]
---

# Welcome to UngalSoththu

This is Your Asset. Urban transit accountability for Chennai and Tamil Nadu.

## Our Mission

Chennai's MTC and broader Tamil Nadu transit systems are vital community assets.
Programs like "Vidiyal Payanam" (free travel for schoolgirls) demonstrate the
social value of these systems.

## What We Do

We provide data tools to help citizens:
- Explore fleet, depot, and route master data
- File RTI requests with specific questions
- Spread awareness via #IthuUngalSoththu

Data-as-accountability: Citizens deserve verifiable data on public assets they fund.
```

This demonstrates the markdown frontmatter schema defined in content.config.ts.
  </action>
  <verify>src/content/en/blog/first-post.md exists with valid frontmatter</verify>
  <done>Markdown file has title, description, publishDate, lang in frontmatter</done>
</task>

<task type="auto">
  <name>Task 3: Create sample Tamil blog post</name>
  <files>src/content/ta/blog/first-post.md</files>
  <action>Create src/content/ta/blog/ directory and first-post.md:

```markdown
---
title: "உங்கள் சொத்துக்கு வரவேற்பு"
description: "தமிழ்நாட்டில் நகர்ப்புற போக்குவரத்து பொறுப்புக்கூற்றிற்கான எங்கள் முன்முயற்சி"
publishDate: 2025-01-11
lang: ta
tags: ["அறிவிப்பு"]
---

# உங்கள் சொத்துக்கு வரவேற்பு

இது உங்கள் சொத்து. சென்னை மற்றும் தமிழ்நாட்டிற்கான நகர்ப்புற போக்குவரத்து பொறுப்புக்கூறு.

## எங்கள் நோக்கம்

சென்னையின் எம்டிசி மற்றும் பரந்த தமிழக போக்குவரத்து அமைப்புகள் முக்கிய சமூக சொத்துகள்.
"விடியல் பயணம்" (பள்ளி மாணவிகளுக்கு இலவச பயணம்) போன்ற திட்டங்கள் இந்த
அமைப்புகளின் சமூக மதிப்பை நிரூபிக்கின்றன.

## எங்கள் வேலை

குடிமக்களுக்கு உதவும் தரவு கருவிகள்:
- பேருந்து தொகுதி, முனையம், மற்றும் வழித்தடத் தகவல்களை ஆராயுங்கள்
- RTI கோரிக்கைகளைத் தாராளமாக தாக்கல் செய்யுங்கள்
- #IthuUngalSoththu மூலம் விழிப்புணர்வைப் பரப்புங்கள்

தரவு என்பது பொறுப்புக்கூறு: குடிமக்கள் தாங்கள் நிதி உதவி வழங்கும்
பொது சொத்துகள் பற்றிய சரிபார்க்கக்கூடிய தரவைப் பெற முடியும்.
```

Mirrors English content in Tamil - demonstrates bilingual content pattern.
  </action>
  <verify>src/content/ta/blog/first-post.md exists with valid frontmatter</verify>
  <done>Tamil markdown file has matching schema with lang: ta</done>
</task>

<task type="auto">
  <name>Task 4: Create blog listing page</name>
  <files>src/pages/blog/index.astro, src/pages/ta/blog/index.astro</files>
  <action>Create English blog listing at src/pages/blog/index.astro:

```astro
---
import Layout from '../../layouts/Layout.astro';
import LanguageSwitch from '../../components/LanguageSwitch.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter(post => post.data.lang === 'en')
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<Layout title="Blog - UngalSoththu" currentLocale="en">
  <LanguageSwitch currentLocale="en" />

  <section>
    <h2>Blog</h2>
    {posts.map(post => (
      <article style={{ marginBottom: '2rem' }}>
        <h3>
          <a href={`/blog/${post.slug}/`}>{post.data.title}</a>
        </h3>
        <p>{post.data.description}</p>
        <small>{post.data.publishDate.toLocaleDateString()}</small>
      </article>
    ))}
  </section>
</Layout>
```

And Tamil blog listing at src/pages/ta/blog/index.astro:

```astro
---
import Layout from '../../../layouts/Layout.astro';
import LanguageSwitch from '../../../components/LanguageSwitch.astro';
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter(post => post.data.lang === 'ta')
  .sort((a, b) => b.data.publishDate.valueOf() - a.data.publishDate.valueOf());
---

<Layout title="வலைப்பதிவு - உங்கள் சொத்து" currentLocale="ta">
  <LanguageSwitch currentLocale="ta" />

  <section>
    <h2>வலைப்பதிவு</h2>
    {posts.map(post => (
      <article style={{ marginBottom: '2rem' }}>
        <h3>
          <a href={`/ta/blog/${post.slug}/`}>{post.data.title}</a>
        </h3>
        <p>{post.data.description}</p>
        <small>{post.data.publishDate.toLocaleDateString('ta-IN')}</small>
      </article>
    ))}
  </section>
</Layout>
```

Creates filtered blog listings by language.
  </action>
  <verify>src/pages/blog/index.astro and src/pages/ta/blog/index.astro exist</verify>
  <done>Both pages filter posts by language, sorted by date descending</done>
</task>

<task type="auto">
  <name>Task 5: Create blog post template page</name>
  <files>src/pages/blog/[...slug].astro, src/pages/ta/blog/[...slug].astro</files>
  <action>Create English blog post template at src/pages/blog/[...slug].astro:

```astro
---
import Layout from '../../layouts/Layout.astro';
import LanguageSwitch from '../../components/LanguageSwitch.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts
    .filter(post => post.data.lang === 'en')
    .map(post => ({
      params: { slug: post.slug },
      props: { post },
    }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<Layout title={post.data.title} currentLocale="en">
  <LanguageSwitch currentLocale="en" />

  <article>
    <h1>{post.data.title}</h1>
    <p>{post.data.description}</p>
    <small>{post.data.publishDate.toLocaleDateString()}</small>
    <hr />
    <Content />
  </article>
</Layout>
```

And Tamil blog post template at src/pages/ta/blog/[...slug].astro:

```astro
---
import Layout from '../../../layouts/Layout.astro';
import LanguageSwitch from '../../../components/LanguageSwitch.astro';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts
    .filter(post => post.data.lang === 'ta')
    .map(post => ({
      params: { slug: post.slug },
      props: { post },
    }));
}

const { post } = Astro.props;
const { Content } = await post.render();
---

<Layout title={post.data.title} currentLocale="ta">
  <LanguageSwitch currentLocale="ta" />

  <article>
    <h1>{post.data.title}</h1>
    <p>{post.data.description}</p>
    <small>{post.data.publishDate.toLocaleDateString('ta-IN')}</small>
    <hr />
    <Content />
  </article>
</Layout>
```

Creates dynamic routes for individual blog posts.
  </action>
  <verify>src/pages/blog/[...slug].astro and src/pages/ta/blog/[...slug].astro exist</verify>
  <done>Both templates use getStaticPaths for dynamic routing, render markdown content</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Content collections with bilingual blog posts and listing pages</what-built>
  <how-to-verify>
    1. Run: npm run dev
    2. Visit: http://localhost:4321/blog/
    3. Verify: English blog listing shows "Welcome to UngalSoththu" post
    4. Click: Post title
    5. Verify: Full blog post page loads with rendered markdown
    6. Click: "தமிழ்" language link
    7. Verify: Navigates to Tamil blog listing at /ta/blog/
    8. Verify: Tamil post "உங்கள் சொத்துக்கு வரவேற்பு" displays
    9. Click: Tamil post title
    10. Verify: Full Tamil blog post renders correctly
    11. Check: Build also works (`npm run build`)
  </how-to-verify>
  <resume-signal>Type "approved" to continue, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] src/content.config.ts exists with blog collection schema
- [ ] Sample English and Tamil blog posts exist
- [ ] Blog listing pages exist for both languages
- [ ] Blog post template pages exist for both languages
- [ ] Content renders correctly in browser
- [ ] Build completes without errors
</verification>

<success_criteria>

- Content collections configured with type-safe Zod schema
- Bilingual sample blog posts demonstrate the pattern
- Blog listing and individual post pages work for both languages
- Markdown content renders correctly
- Phase 1 complete - all foundation pieces in place
  </success_criteria>

<output>
After completion, create `.planning/phases/01-foundation/01-04-SUMMARY.md`:

# Phase 1 Plan 4: Content Collections Structure Summary

**Content collections configured with bilingual blog posts. Phase 1 Foundation complete.**

## Accomplishments

- Created content collections configuration with Zod schema validation
- Set up bilingual blog collection structure (en/ta directories)
- Created sample English and Tamil blog posts
- Built blog listing and individual post pages for both languages
- Demonstrated end-to-end i18n routing with content collections

## Files Created/Modified

- `src/content.config.ts` - Content collections configuration
- `src/content/en/blog/first-post.md` - Sample English blog post
- `src/content/ta/blog/first-post.md` - Sample Tamil blog post
- `src/pages/blog/index.astro` - English blog listing
- `src/pages/ta/blog/index.astro` - Tamil blog listing
- `src/pages/blog/[...slug].astro` - English blog post template
- `src/pages/ta/blog/[...slug].astro` - Tamil blog post template

## Decisions Made

- Single blog collection sufficient to demonstrate pattern (more collections in Phase 3)
- Language filter in getStaticPaths keeps content separated
- Using [...]slug catch-all for clean URLs

## Issues Encountered

None / [Document any issues if they occurred]

## Next Phase Readiness

Phase 1 (Foundation) is complete. Ready for Phase 2 (Design System) which will add:
- Typography system with Tamil font support
- Accessibility foundations
- Base component styles

## Technical Debt / Notes

- Current styles are minimal - Phase 2 will establish design system
- Only one collection type (blog) - additional collections (about, reports, campaigns) in Phase 3
- No navigation menu beyond language switcher - full header navigation in Phase 3
</output>
